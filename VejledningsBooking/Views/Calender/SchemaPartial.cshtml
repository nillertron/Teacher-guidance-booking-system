@model VejledningsBooking.ViewModel.CalenderViewModel
@inject Infrastructure.ApplicationLogic.Person.Concretes.IPersonState state

<div class="row">
    <div class="col-12">
        <div class="float-left">
            <form asp-action="PrevWeek">
                <input type="hidden" asp-for="SelectedHoldId" />

                <button type="submit" class="btn btn-primary">&lsaquo;</button>
            </form>
        </div>
        <div class="float-right">
            <form asp-action="NextWeek">
                <input type="hidden" asp-for="SelectedHoldId" />

                <button type="submit" class="btn btn-primary">&gt;</button>
            </form>
        </div>
    </div>
</div>

<table class="table table-striped table-bordered">
    <thead>
        <tr>
            <th scope="col"><h5 style="white-space:pre-wrap">Time</h5></th>
            @for (int i = 0; i < 5; i++)
            {
                <th scope="col"><h5 style="white-space:pre-wrap">@Model.GetDateFormatted(i)</h5></th>
            }
        </tr>
    </thead>
    <tbody>
        @for (int j = 0; j < Model.Hours.Count; j++)
        {
            <tr>
                <td><h5 style="white-space:nowrap">@Model.Hours[j].ToString("HH:mm") - @Model.Hours[j].AddMinutes(30).ToString("HH:mm")</h5></td>
                @for (int i = 0; i < 5; i++)
                {
                    var appointment = Model.SelectedCalender.Timeslots.FirstOrDefault(y => Model.SelectedCalender.Timeslots.Any(x => y.StartDateTime.TimeOfDay == Model.Hours[j].TimeOfDay && y.StartDateTime.Date == Model.Dates[i].Date));
                    @if (appointment != null)
                    {
                        if (appointment.Booking == null)
                        {
                            <td id="@appointment.Id" onclick="ToggleModal('CreateBookingModal'); retrieveId(this);" data-toggle="modal" data-target="#CreateBookingModal" style="cursor:pointer; color:white;" class="Available-Appointment text-center"><p>Teacher: @appointment.Teacher.FirstName</p></td>

                        }
                        else
                        {
                            <td class="Not-Available-Appointment text-center" style="color:white;">Reserved by @appointment.Booking.Student.FirstName</td>
                        }
                    }
                    else
                    {
                        <td></td>
                    }
                }
            </tr>

        }
    </tbody>
</table> 